<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Karteikarten – Sprachtrainer (Single‑File)</title>
  <meta name="description" content="Moderne, effiziente Web‑App für digitale Karteikarten mit Flip‑Animation, Import/Export und lokaler Speicherung – als Single‑File bereit für GitHub Pages." />
  <style>
    :root{
      --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --primary:#22c55e; --primary-600:#16a34a; --shadow:0 12px 35px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial; background:radial-gradient(1200px 600px at 70% -10%, #1f2937 0%, var(--bg) 60%); color:var(--text); display:flex; flex-direction:column}

    .topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;background:rgba(255,255,255,.02);backdrop-filter:blur(6px);border-bottom:1px solid rgba(255,255,255,.06)}
    .topbar h1{margin:0;font-size:clamp(18px,2vw,22px);letter-spacing:.3px}
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

    .btn{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.18);padding:10px 14px;border-radius:12px;cursor:pointer;transition:all .18s ease;font-weight:600}
    .btn:hover{transform:translateY(-1px);border-color:rgba(255,255,255,.35)}
    .btn.primary{background:var(--primary);border-color:var(--primary);color:#03110a}
    .btn.primary:hover{background:var(--primary-600);border-color:var(--primary-600)}
    .btn.secondary{background:rgba(255,255,255,.04)}

    .switch{display:flex;align-items:center;gap:8px;cursor:pointer}
    .switch input{accent-color:var(--primary);cursor:pointer}

    .app{flex:1;display:grid;grid-template-rows:1fr auto auto;gap:18px;padding:20px;max-width:900px;margin:0 auto;width:100%}
    .stage{display:grid;place-items:center;min-height:360px}

    .card{width:min(680px,92vw);height:min(380px,56vh);perspective:1400px;outline:none}
    .card-inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;transition:transform 600ms cubic-bezier(.2,.7,.2,1)}
    .card.flipped .card-inner{transform:rotateY(180deg)}
    .card-face{position:absolute;inset:0;border-radius:22px;display:flex;align-items:center;justify-content:center;padding:28px;text-align:center;font-size:clamp(22px,4.5vw,40px);background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.12);box-shadow:var(--shadow);backface-visibility:hidden}
    .card-back{transform:rotateY(180deg)}
    .card-face::after{content:"";position:absolute;inset:auto 18px 18px auto;width:56px;height:56px;border-radius:50%;background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.18),rgba(255,255,255,0) 60%);filter:blur(10px);opacity:.5;pointer-events:none}

    .actions{display:flex;gap:10px;justify-content:center}
    .progress{display:grid;place-items:center;color:var(--muted)}
    .footer{padding:12px 20px;color:var(--muted);text-align:center;border-top:1px solid rgba(255,255,255,.06)}

    dialog{border:none;border-radius:16px;padding:18px 18px 10px;width:min(520px,92vw);background:#0b1223;color:var(--text);box-shadow:var(--shadow)}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    dialog h2{margin:.2rem 0 1rem 0}
    dialog label{display:block;margin:.6rem 0}
    dialog input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.18);background:#0c1429;color:var(--text)}
    dialog menu{display:flex;gap:10px;justify-content:flex-end;margin-top:1rem}
  </style>
</head>
<body>
  <header class="topbar" role="banner">
    <h1>Karteikarten</h1>
    <nav class="controls" aria-label="Hauptsteuerung">
      <button id="btn-new" class="btn">+ Karte</button>
      <button id="btn-import" class="btn">Import</button>
      <button id="btn-export" class="btn">Export</button>
      <label class="switch"><input type="checkbox" id="chk-shuffle"><span>Shuffle</span></label>
    </nav>
  </header>

  <main id="app" class="app" role="main">
    <section class="stage">
      <div id="card" class="card" tabindex="0" aria-live="polite" aria-label="Karte. Leertaste: Umdrehen.">
        <div class="card-inner" id="cardInner">
          <div class="card-face card-front" id="cardFront"></div>
          <div class="card-face card-back" id="cardBack"></div>
        </div>
      </div>
    </section>

    <section class="actions" aria-label="Karten-Navigation">
      <button id="btn-prev" class="btn secondary" title="Vorherige (←)">←</button>
      <button id="btn-flip" class="btn primary" title="Umdrehen (Leertaste)">Flip</button>
      <button id="btn-next" class="btn secondary" title="Nächste (→)">→</button>
    </section>

    <section class="progress" aria-label="Fortschritt">
      <div id="progressText">0 / 0</div>
    </section>
  </main>

  <dialog id="dlg-new">
    <form method="dialog" id="form-new">
      <h2>Neue Karte hinzufügen</h2>
      <label>Vorderseite (Deutsch)
        <input id="new-front" required placeholder="z. B. Haus" />
      </label>
      <label>Rückseite (Übersetzung)
        <input id="new-back" required placeholder="z. B. house (en)" />
      </label>
      <menu>
        <button value="cancel" class="btn secondary">Abbrechen</button>
        <button value="ok" class="btn primary">Speichern</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlg-import">
    <form method="dialog" id="form-import">
      <h2>Import</h2>
      <p>CSV (front,back) oder JSON ([{"front":"","back":""}, ...])</p>
      <input type="file" id="file-input" accept=".csv,.json" />
      <menu>
        <button value="cancel" class="btn secondary">Abbrechen</button>
        <button value="ok" class="btn primary">Importieren</button>
      </menu>
    </form>
  </dialog>

  <footer class="footer" role="contentinfo">
    <small>Shortcuts: Space=Flip • ←/→=Navigation • N=Neue Karte • U=Import • S=Shuffle</small>
  </footer>

  <script>
  (() => {
    'use strict';
    const STORAGE_KEY = 'flashcards_v1';
    /** @typedef {{id:string, front:string, back:string}} Card */
    /** @type {{cards: Card[], index: number, shuffled: boolean}} */
    let state = loadState() || { cards: sampleDeck(), index: 0, shuffled: false };

    // Elements
    const elCard = document.getElementById('card');
    const elFront = document.getElementById('cardFront');
    const elBack = document.getElementById('cardBack');
    const elPrev = document.getElementById('btn-prev');
    const elNext = document.getElementById('btn-next');
    const elFlip = document.getElementById('btn-flip');
    const elProgress = document.getElementById('progressText');
    const elNew = document.getElementById('btn-new');
    const elImport = document.getElementById('btn-import');
    const elExport = document.getElementById('btn-export');
    const elShuffle = document.getElementById('chk-shuffle');

    const dlgNew = document.getElementById('dlg-new');
    const dlgImport = document.getElementById('dlg-import');
    const inputNewFront = document.getElementById('new-front');
    const inputNewBack = document.getElementById('new-back');
    const fileInput = document.getElementById('file-input');

    elShuffle.checked = !!state.shuffled;
    render(true);

    // Events
    elCard.addEventListener('click', flip);
    elFlip.addEventListener('click', flip);
    elPrev.addEventListener('click', prev);
    elNext.addEventListener('click', next);
    elNew.addEventListener('click', () => { dlgNew.showModal(); setTimeout(() => inputNewFront.focus(), 50); });
    elImport.addEventListener('click', () => dlgImport.showModal());
    elExport.addEventListener('click', exportJSON);

    elShuffle.addEventListener('change', () => {
      state.shuffled = !!elShuffle.checked;
      if (state.shuffled) {
        shuffle(state.cards); state.index = 0;
      } else {
        state.cards.sort((a,b) => a.front.localeCompare(b.front)); state.index = 0;
      }
      persist(); render(true);
    });

    dlgNew.addEventListener('close', () => {
      if (dlgNew.returnValue === 'ok') {
        const front = inputNewFront.value.trim();
        const back = inputNewBack.value.trim();
        if (front && back) {
          state.cards.push({ id: id(), front, back });
          state.index = state.cards.length - 1;
          persist(); render(true);
        }
      }
      inputNewFront.value = ''; inputNewBack.value = '';
    });

    dlgImport.addEventListener('close', async () => {
      if (dlgImport.returnValue === 'ok') {
        const file = fileInput.files && fileInput.files[0];
        if (!file) return;
        try {
          const text = await file.text();
          let cards;
          if (file.name.toLowerCase().endsWith('.json')) {
            const parsed = JSON.parse(text);
            if (!Array.isArray(parsed)) throw new Error('JSON muss ein Array sein.');
            cards = parsed.map(row => validateRow(row.front, row.back));
          } else {
            cards = parseCSV(text);
          }
          state.cards = cards.map(r => ({ id: id(), front: r.front, back: r.back }));
          state.index = 0; persist(); render(true);
        } catch (err) {
          alert('Import fehlgeschlagen: ' + (err && err.message ? err.message : err));
        } finally {
          fileInput.value = '';
        }
      } else {
        fileInput.value = '';
      }
    });

    document.addEventListener('keydown', (e) => {
      if (isDialogOpen()) return;
      if (e.key === ' ') { e.preventDefault(); flip(); }
      if (e.key === 'ArrowRight') next();
      if (e.key === 'ArrowLeft') prev();
      if (e.key.toLowerCase() === 'n') dlgNew.showModal();
      if (e.key.toLowerCase() === 'u') dlgImport.showModal();
      if (e.key.toLowerCase() === 's') elShuffle.click();
    });

    function isDialogOpen(){ return dlgNew.open || dlgImport.open; }

    function render(resetFlip=false){
      const card = current();
      if (!card) {
        elFront.textContent = 'Keine Karten vorhanden. Importieren Sie CSV/JSON oder fügen Sie Karten hinzu.';
        elBack.textContent = 'Beispiel CSV:\nHaus,house\nBaum,tree';
        elProgress.textContent = '0 / 0';
        return;
      }
      elFront.textContent = card.front;
      elBack.textContent = card.back;
      elProgress.textContent = `${state.index + 1} / ${state.cards.length}`;
      if (resetFlip) document.getElementById('card').classList.remove('flipped');
    }

    function flip(){ document.getElementById('card').classList.toggle('flipped'); }
    function next(){ state.index = (state.index + 1) % Math.max(1, state.cards.length); persist(); render(true); }
    function prev(){ state.index = (state.index - 1 + state.cards.length) % Math.max(1, state.cards.length); persist(); render(true); }
    function current(){ return state.cards[state.index]; }

    function persist(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
    function loadState(){ try { const raw = localStorage.getItem(STORAGE_KEY); if(!raw) return null; const s = JSON.parse(raw); return Array.isArray(s.cards) ? s : null; } catch { return null; } }

    function shuffle(arr){ for (let i=arr.length-1; i>0; i--){ const j = Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }
    function id(){ return (crypto && crypto.randomUUID) ? crypto.randomUUID() : 'id-'+Math.random().toString(36).slice(2)+Date.now().toString(36); }

    function sampleDeck(){
      return [
        { id:id(), front:'Haus', back:'house' },
        { id:id(), front:'Baum', back:'tree' },
        { id:id(), front:'Straße', back:'street' },
        { id:id(), front:'Freund', back:'friend' },
        { id:id(), front:'Zeit', back:'time' }
      ];
    }

    function validateRow(front, back){
      if (typeof front !== 'string' || typeof back !== 'string' || !front.trim() || !back.trim())
        throw new Error('Ungültige Datenzeile. Erforderlich: front, back.');
      return { front: front.trim(), back: back.trim() };
    }

    function parseCSV(text){
      const rows = []; const lines = text.split(/\r?\n/).filter(l => l.trim().length);
      for (const line of lines){
        const vals = []; let cur=''; let inQ=false;
        for (let i=0;i<line.length;i++){
          const c=line[i];
          if (c==='"'){
            if (inQ && line[i+1]==='"'){ cur+='"'; i++; }
            else inQ=!inQ;
          } else if (c===',' && !inQ){ vals.push(cur); cur=''; }
          else { cur+=c; }
        }
        vals.push(cur);
        if (vals.length < 2) throw new Error('CSV: Jede Zeile benötigt zwei Spalten (front, back).');
        rows.push(validateRow(vals[0], vals[1]));
      }
      return rows;
    }

    function exportJSON(){
      const payload = state.cards.map(c => ({ front: c.front, back: c.back }));
      const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'flashcards-' + new Date().toISOString().slice(0,10) + '.json';
      document.body.appendChild(a); a.click();
      setTimeout(() => { URL.revokeObjectURL(a.href); a.remove(); }, 0);
    }
  })();
  </script>
</body>
</html>
